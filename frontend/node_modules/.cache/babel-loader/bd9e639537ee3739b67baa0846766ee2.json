{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst logger_1 = require(\"./utils/logger\");\n\nconst SYNC_DOCUMENT_NOTIFICATION_TYPE = 'com.twilio.rtd.cds.document';\nconst SYNC_LIST_NOTIFICATION_TYPE = 'com.twilio.rtd.cds.list';\nconst SYNC_MAP_NOTIFICATION_TYPE = 'com.twilio.rtd.cds.map';\nconst SYNC_NOTIFICATION_TYPE = 'twilio.sync.event';\n/**\n * @class Router\n * @classdesc Routes all incoming messages to the consumers\n */\n\nclass Router {\n  constructor(params) {\n    this.config = params.config;\n    this.subscriptions = params.subscriptions;\n    this.notifications = params.notifications;\n    this.notifications.subscribe(SYNC_NOTIFICATION_TYPE);\n    this.notifications.subscribe(SYNC_DOCUMENT_NOTIFICATION_TYPE);\n    this.notifications.subscribe(SYNC_LIST_NOTIFICATION_TYPE);\n    this.notifications.subscribe(SYNC_MAP_NOTIFICATION_TYPE);\n    this.notifications.on('message', (messageType, payload) => this.onMessage(messageType, payload));\n    this.notifications.on('transportReady', isConnected => this.onConnectionStateChanged(isConnected));\n  }\n  /**\n   * Entry point for all incoming messages\n   * @param {String} type - Type of incoming message\n   * @param {Object} message - Message to route\n   */\n\n\n  onMessage(type, message) {\n    logger_1.default.trace('Notification type:', type, 'content:', message);\n\n    switch (type) {\n      case SYNC_DOCUMENT_NOTIFICATION_TYPE:\n      case SYNC_LIST_NOTIFICATION_TYPE:\n      case SYNC_MAP_NOTIFICATION_TYPE:\n        this.subscriptions.acceptMessage(message, false);\n        break;\n\n      case SYNC_NOTIFICATION_TYPE:\n        this.subscriptions.acceptMessage(message, true);\n        break;\n    }\n  }\n  /**\n   * Subscribe for events\n   */\n\n\n  subscribe(sid, entity) {\n    this.subscriptions.add(sid, entity);\n  }\n  /**\n   * Unsubscribe from events\n   */\n\n\n  unsubscribe(sid) {\n    this.subscriptions.remove(sid);\n  }\n  /**\n   * Handle transport establishing event\n   * If we have any subscriptions - we should check object for modifications\n   */\n\n\n  onConnectionStateChanged(isConnected) {\n    this.subscriptions.onConnectionStateChanged(isConnected);\n  }\n\n}\n\nexports.Router = Router;\nexports.default = Router;","map":{"version":3,"sources":["/home/ascencion/sebrae_megahack/node_modules/twilio-sync/lib/router.js"],"names":["Object","defineProperty","exports","value","logger_1","require","SYNC_DOCUMENT_NOTIFICATION_TYPE","SYNC_LIST_NOTIFICATION_TYPE","SYNC_MAP_NOTIFICATION_TYPE","SYNC_NOTIFICATION_TYPE","Router","constructor","params","config","subscriptions","notifications","subscribe","on","messageType","payload","onMessage","isConnected","onConnectionStateChanged","type","message","default","trace","acceptMessage","sid","entity","add","unsubscribe","remove"],"mappings":"AAAA;;AACAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAAEC,EAAAA,KAAK,EAAE;AAAT,CAA7C;;AACA,MAAMC,QAAQ,GAAGC,OAAO,CAAC,gBAAD,CAAxB;;AACA,MAAMC,+BAA+B,GAAG,6BAAxC;AACA,MAAMC,2BAA2B,GAAG,yBAApC;AACA,MAAMC,0BAA0B,GAAG,wBAAnC;AACA,MAAMC,sBAAsB,GAAG,mBAA/B;AACA;;;;;AAIA,MAAMC,MAAN,CAAa;AACTC,EAAAA,WAAW,CAACC,MAAD,EAAS;AAChB,SAAKC,MAAL,GAAcD,MAAM,CAACC,MAArB;AACA,SAAKC,aAAL,GAAqBF,MAAM,CAACE,aAA5B;AACA,SAAKC,aAAL,GAAqBH,MAAM,CAACG,aAA5B;AACA,SAAKA,aAAL,CAAmBC,SAAnB,CAA6BP,sBAA7B;AACA,SAAKM,aAAL,CAAmBC,SAAnB,CAA6BV,+BAA7B;AACA,SAAKS,aAAL,CAAmBC,SAAnB,CAA6BT,2BAA7B;AACA,SAAKQ,aAAL,CAAmBC,SAAnB,CAA6BR,0BAA7B;AACA,SAAKO,aAAL,CAAmBE,EAAnB,CAAsB,SAAtB,EAAiC,CAACC,WAAD,EAAcC,OAAd,KAA0B,KAAKC,SAAL,CAAeF,WAAf,EAA4BC,OAA5B,CAA3D;AACA,SAAKJ,aAAL,CAAmBE,EAAnB,CAAsB,gBAAtB,EAAwCI,WAAW,IAAI,KAAKC,wBAAL,CAA8BD,WAA9B,CAAvD;AACH;AACD;;;;;;;AAKAD,EAAAA,SAAS,CAACG,IAAD,EAAOC,OAAP,EAAgB;AACrBpB,IAAAA,QAAQ,CAACqB,OAAT,CAAiBC,KAAjB,CAAuB,oBAAvB,EAA6CH,IAA7C,EAAmD,UAAnD,EAA+DC,OAA/D;;AACA,YAAQD,IAAR;AACI,WAAKjB,+BAAL;AACA,WAAKC,2BAAL;AACA,WAAKC,0BAAL;AACI,aAAKM,aAAL,CAAmBa,aAAnB,CAAiCH,OAAjC,EAA0C,KAA1C;AACA;;AACJ,WAAKf,sBAAL;AACI,aAAKK,aAAL,CAAmBa,aAAnB,CAAiCH,OAAjC,EAA0C,IAA1C;AACA;AARR;AAUH;AACD;;;;;AAGAR,EAAAA,SAAS,CAACY,GAAD,EAAMC,MAAN,EAAc;AACnB,SAAKf,aAAL,CAAmBgB,GAAnB,CAAuBF,GAAvB,EAA4BC,MAA5B;AACH;AACD;;;;;AAGAE,EAAAA,WAAW,CAACH,GAAD,EAAM;AACb,SAAKd,aAAL,CAAmBkB,MAAnB,CAA0BJ,GAA1B;AACH;AACD;;;;;;AAIAN,EAAAA,wBAAwB,CAACD,WAAD,EAAc;AAClC,SAAKP,aAAL,CAAmBQ,wBAAnB,CAA4CD,WAA5C;AACH;;AAhDQ;;AAkDbnB,OAAO,CAACQ,MAAR,GAAiBA,MAAjB;AACAR,OAAO,CAACuB,OAAR,GAAkBf,MAAlB","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst logger_1 = require(\"./utils/logger\");\nconst SYNC_DOCUMENT_NOTIFICATION_TYPE = 'com.twilio.rtd.cds.document';\nconst SYNC_LIST_NOTIFICATION_TYPE = 'com.twilio.rtd.cds.list';\nconst SYNC_MAP_NOTIFICATION_TYPE = 'com.twilio.rtd.cds.map';\nconst SYNC_NOTIFICATION_TYPE = 'twilio.sync.event';\n/**\n * @class Router\n * @classdesc Routes all incoming messages to the consumers\n */\nclass Router {\n    constructor(params) {\n        this.config = params.config;\n        this.subscriptions = params.subscriptions;\n        this.notifications = params.notifications;\n        this.notifications.subscribe(SYNC_NOTIFICATION_TYPE);\n        this.notifications.subscribe(SYNC_DOCUMENT_NOTIFICATION_TYPE);\n        this.notifications.subscribe(SYNC_LIST_NOTIFICATION_TYPE);\n        this.notifications.subscribe(SYNC_MAP_NOTIFICATION_TYPE);\n        this.notifications.on('message', (messageType, payload) => this.onMessage(messageType, payload));\n        this.notifications.on('transportReady', isConnected => this.onConnectionStateChanged(isConnected));\n    }\n    /**\n     * Entry point for all incoming messages\n     * @param {String} type - Type of incoming message\n     * @param {Object} message - Message to route\n     */\n    onMessage(type, message) {\n        logger_1.default.trace('Notification type:', type, 'content:', message);\n        switch (type) {\n            case SYNC_DOCUMENT_NOTIFICATION_TYPE:\n            case SYNC_LIST_NOTIFICATION_TYPE:\n            case SYNC_MAP_NOTIFICATION_TYPE:\n                this.subscriptions.acceptMessage(message, false);\n                break;\n            case SYNC_NOTIFICATION_TYPE:\n                this.subscriptions.acceptMessage(message, true);\n                break;\n        }\n    }\n    /**\n     * Subscribe for events\n     */\n    subscribe(sid, entity) {\n        this.subscriptions.add(sid, entity);\n    }\n    /**\n     * Unsubscribe from events\n     */\n    unsubscribe(sid) {\n        this.subscriptions.remove(sid);\n    }\n    /**\n     * Handle transport establishing event\n     * If we have any subscriptions - we should check object for modifications\n     */\n    onConnectionStateChanged(isConnected) {\n        this.subscriptions.onConnectionStateChanged(isConnected);\n    }\n}\nexports.Router = Router;\nexports.default = Router;\n"]},"metadata":{},"sourceType":"script"}