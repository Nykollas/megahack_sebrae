{"ast":null,"code":"import { isMobile } from '../../../utils';\nimport { useEffect, useRef } from 'react';\nimport useLocalVideoToggle from '../../../hooks/useLocalVideoToggle/useLocalVideoToggle';\nimport useVideoContext from '../../../hooks/useVideoContext/useVideoContext';\n/* \n  This component adds a visibilitychange handler to the document when\n  the user is using a mobile device. When the handler detects that\n  the browser has been backgrounded, it unpublishes the users local\n  video track. The browser cannot send video to the room when it has\n  been backgrounded, so unpublishing the track stops video capture\n  on the device, and triggers a UI update for all other participants\n  to show that this user's video track has been turned off.\n*/\n\nexport default function AttachVisibilityHandler() {\n  const {\n    room\n  } = useVideoContext();\n  const [isVideoEnabled, toggleVideoEnabled] = useLocalVideoToggle();\n  const shouldRepublishVideoOnForeground = useRef(false);\n  useEffect(() => {\n    if (isMobile) {\n      const handleVisibilityChange = () => {\n        // We don't need to unpublish the local video track if it has already been unpublished\n        if (document.visibilityState === 'hidden' && isVideoEnabled) {\n          shouldRepublishVideoOnForeground.current = true;\n          toggleVideoEnabled(); // Don't publish the local video track if it wasn't published before the app was backgrounded\n        } else if (shouldRepublishVideoOnForeground.current) {\n          shouldRepublishVideoOnForeground.current = false;\n          toggleVideoEnabled();\n        }\n      };\n\n      document.addEventListener('visibilitychange', handleVisibilityChange);\n      return () => {\n        document.removeEventListener('visibilitychange', handleVisibilityChange);\n      };\n    }\n  }, [isVideoEnabled, room, toggleVideoEnabled]);\n  return null;\n}","map":{"version":3,"sources":["/home/ascencion/sebrae_megahack/src/components/VideoProvider/AttachVisibilityHandler/AttachVisibilityHandler.tsx"],"names":["isMobile","useEffect","useRef","useLocalVideoToggle","useVideoContext","AttachVisibilityHandler","room","isVideoEnabled","toggleVideoEnabled","shouldRepublishVideoOnForeground","handleVisibilityChange","document","visibilityState","current","addEventListener","removeEventListener"],"mappings":"AAAA,SAASA,QAAT,QAAyB,gBAAzB;AACA,SAASC,SAAT,EAAoBC,MAApB,QAAkC,OAAlC;AACA,OAAOC,mBAAP,MAAgC,wDAAhC;AACA,OAAOC,eAAP,MAA4B,gDAA5B;AAEA;;;;;;;;;;AAUA,eAAe,SAASC,uBAAT,GAAmC;AAChD,QAAM;AAAEC,IAAAA;AAAF,MAAWF,eAAe,EAAhC;AACA,QAAM,CAACG,cAAD,EAAiBC,kBAAjB,IAAuCL,mBAAmB,EAAhE;AACA,QAAMM,gCAAgC,GAAGP,MAAM,CAAC,KAAD,CAA/C;AAEAD,EAAAA,SAAS,CAAC,MAAM;AACd,QAAID,QAAJ,EAAc;AACZ,YAAMU,sBAAsB,GAAG,MAAM;AACnC;AACA,YAAIC,QAAQ,CAACC,eAAT,KAA6B,QAA7B,IAAyCL,cAA7C,EAA6D;AAC3DE,UAAAA,gCAAgC,CAACI,OAAjC,GAA2C,IAA3C;AACAL,UAAAA,kBAAkB,GAFyC,CAI3D;AACD,SALD,MAKO,IAAIC,gCAAgC,CAACI,OAArC,EAA8C;AACnDJ,UAAAA,gCAAgC,CAACI,OAAjC,GAA2C,KAA3C;AACAL,UAAAA,kBAAkB;AACnB;AACF,OAXD;;AAaAG,MAAAA,QAAQ,CAACG,gBAAT,CAA0B,kBAA1B,EAA8CJ,sBAA9C;AACA,aAAO,MAAM;AACXC,QAAAA,QAAQ,CAACI,mBAAT,CAA6B,kBAA7B,EAAiDL,sBAAjD;AACD,OAFD;AAGD;AACF,GApBQ,EAoBN,CAACH,cAAD,EAAiBD,IAAjB,EAAuBE,kBAAvB,CApBM,CAAT;AAsBA,SAAO,IAAP;AACD","sourcesContent":["import { isMobile } from '../../../utils';\nimport { useEffect, useRef } from 'react';\nimport useLocalVideoToggle from '../../../hooks/useLocalVideoToggle/useLocalVideoToggle';\nimport useVideoContext from '../../../hooks/useVideoContext/useVideoContext';\n\n/* \n  This component adds a visibilitychange handler to the document when\n  the user is using a mobile device. When the handler detects that\n  the browser has been backgrounded, it unpublishes the users local\n  video track. The browser cannot send video to the room when it has\n  been backgrounded, so unpublishing the track stops video capture\n  on the device, and triggers a UI update for all other participants\n  to show that this user's video track has been turned off.\n*/\n\nexport default function AttachVisibilityHandler() {\n  const { room } = useVideoContext();\n  const [isVideoEnabled, toggleVideoEnabled] = useLocalVideoToggle();\n  const shouldRepublishVideoOnForeground = useRef(false);\n\n  useEffect(() => {\n    if (isMobile) {\n      const handleVisibilityChange = () => {\n        // We don't need to unpublish the local video track if it has already been unpublished\n        if (document.visibilityState === 'hidden' && isVideoEnabled) {\n          shouldRepublishVideoOnForeground.current = true;\n          toggleVideoEnabled();\n\n          // Don't publish the local video track if it wasn't published before the app was backgrounded\n        } else if (shouldRepublishVideoOnForeground.current) {\n          shouldRepublishVideoOnForeground.current = false;\n          toggleVideoEnabled();\n        }\n      };\n\n      document.addEventListener('visibilitychange', handleVisibilityChange);\n      return () => {\n        document.removeEventListener('visibilitychange', handleVisibilityChange);\n      };\n    }\n  }, [isVideoEnabled, room, toggleVideoEnabled]);\n\n  return null;\n}\n"]},"metadata":{},"sourceType":"module"}