{"ast":null,"code":"'use strict';\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nvar MediaStream = require('@twilio/webrtc').MediaStream;\n\nvar Track = require('./');\n/**\n * A {@link MediaTrack} represents audio or video that can be sent to or\n * received from a {@link Room}.\n * @extends Track\n * @property {Track.ID} id - This {@link Track}'s ID\n * @property {boolean} isStarted - Whether or not the {@link MediaTrack} has\n *   started\n * @property {boolean} isEnabled - Whether or not the {@link MediaTrack} is\n *   enabled (i.e., whether it is paused or muted)\n * @property {Track.Kind} kind - The kind of the underlying\n *   MediaStreamTrack, \"audio\" or \"video\"\n * @property {MediaStreamTrack} mediaStreamTrack - The underlying\n *   MediaStreamTrack\n * @emits MediaTrack#disabled\n * @emits MediaTrack#enabled\n * @emits MediaTrack#started\n */\n\n\nvar MediaTrack = function (_Track) {\n  _inherits(MediaTrack, _Track);\n  /**\n   * Construct a {@link MediaTrack}.\n   * @param {MediaTrackTransceiver} mediaTrackTransceiver\n   * @param {{log: Log}} options\n   */\n\n\n  function MediaTrack(mediaTrackTransceiver, options) {\n    _classCallCheck(this, MediaTrack);\n\n    var _this = _possibleConstructorReturn(this, (MediaTrack.__proto__ || Object.getPrototypeOf(MediaTrack)).call(this, mediaTrackTransceiver.id, mediaTrackTransceiver.kind, options));\n\n    var isStarted = false;\n    options = Object.assign({\n      MediaStream: MediaStream\n    }, options);\n    /* istanbul ignore next */\n\n    Object.defineProperties(_this, {\n      _attachments: {\n        value: new Set()\n      },\n      _dummyEl: {\n        value: null,\n        writable: true\n      },\n      _isStarted: {\n        get: function get() {\n          return isStarted;\n        },\n        set: function set(_isStarted) {\n          isStarted = _isStarted;\n        }\n      },\n      _MediaStream: {\n        value: options.MediaStream\n      },\n      isStarted: {\n        enumerable: true,\n        get: function get() {\n          return isStarted;\n        }\n      },\n      mediaStreamTrack: {\n        enumerable: true,\n        value: mediaTrackTransceiver.track\n      }\n    });\n\n    _this._initialize();\n\n    return _this;\n  }\n  /**\n   * @private\n   */\n\n\n  _createClass(MediaTrack, [{\n    key: '_start',\n    value: function _start() {\n      this._log.debug('Started');\n\n      this._isStarted = true;\n\n      if (this._dummyEl) {\n        this._dummyEl.oncanplay = null;\n      } // eslint-disable-next-line no-use-before-define\n\n\n      this.emit('started', this);\n    }\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_initialize',\n    value: function _initialize() {\n      var self = this;\n\n      this._log.debug('Initializing');\n\n      this._dummyEl = this._createElement();\n      this.mediaStreamTrack.addEventListener('ended', function onended() {\n        self._end();\n\n        self.mediaStreamTrack.removeEventListener('ended', onended);\n      });\n\n      if (this._dummyEl) {\n        this._dummyEl.muted = true;\n        this._dummyEl.oncanplay = this._start.bind(this, this._dummyEl);\n\n        this._attach(this._dummyEl);\n\n        this._attachments.delete(this._dummyEl);\n      }\n    }\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_end',\n    value: function _end() {\n      this._log.debug('Ended');\n\n      if (this._dummyEl) {\n        this._detachElement(this._dummyEl);\n\n        this._dummyEl.oncanplay = null;\n      }\n    }\n  }, {\n    key: 'attach',\n    value: function attach(el) {\n      if (typeof el === 'string') {\n        el = this._selectElement(el);\n      } else if (!el) {\n        el = this._createElement();\n      }\n\n      this._log.debug('Attempting to attach to element:', el);\n\n      el = this._attach(el);\n      return el;\n    }\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_attach',\n    value: function _attach(el) {\n      var mediaStream = el.srcObject;\n\n      if (!(mediaStream instanceof this._MediaStream)) {\n        mediaStream = new this._MediaStream();\n      }\n\n      var getTracks = this.mediaStreamTrack.kind === 'audio' ? 'getAudioTracks' : 'getVideoTracks';\n      mediaStream[getTracks]().forEach(function (mediaStreamTrack) {\n        mediaStream.removeTrack(mediaStreamTrack);\n      });\n      mediaStream.addTrack(this.mediaStreamTrack); // NOTE(mpatwardhan): resetting `srcObject` here, causes flicker (JSDK-2641), but it lets us\n      // to sidestep the a chrome bug: https://bugs.chromium.org/p/chromium/issues/detail?id=1052353\n      //\n\n      el.srcObject = mediaStream;\n      el.autoplay = true;\n      el.playsInline = true;\n\n      if (!this._attachments.has(el)) {\n        this._attachments.add(el);\n      }\n\n      return el;\n    }\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_selectElement',\n    value: function _selectElement(selector) {\n      var el = document.querySelector(selector);\n\n      if (!el) {\n        throw new Error('Selector matched no element: ' + selector);\n      }\n\n      return el;\n    }\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_createElement',\n    value: function _createElement() {\n      return typeof document !== 'undefined' ? document.createElement(this.kind) : null;\n    }\n  }, {\n    key: 'detach',\n    value: function detach(el) {\n      var els = void 0;\n\n      if (typeof el === 'string') {\n        els = [this._selectElement(el)];\n      } else if (!el) {\n        els = this._getAllAttachedElements();\n      } else {\n        els = [el];\n      }\n\n      this._log.debug('Attempting to detach from elements:', els);\n\n      this._detachElements(els);\n\n      return el ? els[0] : els;\n    }\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_detachElements',\n    value: function _detachElements(elements) {\n      return elements.map(this._detachElement.bind(this));\n    }\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_detachElement',\n    value: function _detachElement(el) {\n      if (!this._attachments.has(el)) {\n        return el;\n      }\n\n      var mediaStream = el.srcObject;\n\n      if (mediaStream instanceof this._MediaStream) {\n        mediaStream.removeTrack(this.mediaStreamTrack);\n      }\n\n      this._attachments.delete(el);\n\n      return el;\n    }\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_getAllAttachedElements',\n    value: function _getAllAttachedElements() {\n      var els = [];\n\n      this._attachments.forEach(function (el) {\n        els.push(el);\n      });\n\n      return els;\n    }\n  }]);\n\n  return MediaTrack;\n}(Track);\n\nmodule.exports = MediaTrack;","map":{"version":3,"sources":["/home/ascencion/sebrae_megahack/node_modules/twilio-video/es5/media/track/mediatrack.js"],"names":["_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","Constructor","protoProps","staticProps","prototype","_classCallCheck","instance","TypeError","_possibleConstructorReturn","self","call","ReferenceError","_inherits","subClass","superClass","create","constructor","value","setPrototypeOf","__proto__","MediaStream","require","Track","MediaTrack","_Track","mediaTrackTransceiver","options","_this","getPrototypeOf","id","kind","isStarted","assign","_attachments","Set","_dummyEl","_isStarted","get","set","_MediaStream","mediaStreamTrack","track","_initialize","_start","_log","debug","oncanplay","emit","_createElement","addEventListener","onended","_end","removeEventListener","muted","bind","_attach","delete","_detachElement","attach","el","_selectElement","mediaStream","srcObject","getTracks","forEach","removeTrack","addTrack","autoplay","playsInline","has","add","selector","document","querySelector","Error","createElement","detach","els","_getAllAttachedElements","_detachElements","elements","map","push","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar MediaStream = require('@twilio/webrtc').MediaStream;\nvar Track = require('./');\n\n/**\n * A {@link MediaTrack} represents audio or video that can be sent to or\n * received from a {@link Room}.\n * @extends Track\n * @property {Track.ID} id - This {@link Track}'s ID\n * @property {boolean} isStarted - Whether or not the {@link MediaTrack} has\n *   started\n * @property {boolean} isEnabled - Whether or not the {@link MediaTrack} is\n *   enabled (i.e., whether it is paused or muted)\n * @property {Track.Kind} kind - The kind of the underlying\n *   MediaStreamTrack, \"audio\" or \"video\"\n * @property {MediaStreamTrack} mediaStreamTrack - The underlying\n *   MediaStreamTrack\n * @emits MediaTrack#disabled\n * @emits MediaTrack#enabled\n * @emits MediaTrack#started\n */\n\nvar MediaTrack = function (_Track) {\n  _inherits(MediaTrack, _Track);\n\n  /**\n   * Construct a {@link MediaTrack}.\n   * @param {MediaTrackTransceiver} mediaTrackTransceiver\n   * @param {{log: Log}} options\n   */\n  function MediaTrack(mediaTrackTransceiver, options) {\n    _classCallCheck(this, MediaTrack);\n\n    var _this = _possibleConstructorReturn(this, (MediaTrack.__proto__ || Object.getPrototypeOf(MediaTrack)).call(this, mediaTrackTransceiver.id, mediaTrackTransceiver.kind, options));\n\n    var isStarted = false;\n\n    options = Object.assign({\n      MediaStream: MediaStream\n    }, options);\n\n    /* istanbul ignore next */\n    Object.defineProperties(_this, {\n      _attachments: {\n        value: new Set()\n      },\n      _dummyEl: {\n        value: null,\n        writable: true\n      },\n      _isStarted: {\n        get: function get() {\n          return isStarted;\n        },\n        set: function set(_isStarted) {\n          isStarted = _isStarted;\n        }\n      },\n      _MediaStream: {\n        value: options.MediaStream\n      },\n      isStarted: {\n        enumerable: true,\n        get: function get() {\n          return isStarted;\n        }\n      },\n      mediaStreamTrack: {\n        enumerable: true,\n        value: mediaTrackTransceiver.track\n      }\n    });\n\n    _this._initialize();\n    return _this;\n  }\n\n  /**\n   * @private\n   */\n\n\n  _createClass(MediaTrack, [{\n    key: '_start',\n    value: function _start() {\n      this._log.debug('Started');\n      this._isStarted = true;\n      if (this._dummyEl) {\n        this._dummyEl.oncanplay = null;\n      }\n      // eslint-disable-next-line no-use-before-define\n      this.emit('started', this);\n    }\n\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_initialize',\n    value: function _initialize() {\n      var self = this;\n\n      this._log.debug('Initializing');\n      this._dummyEl = this._createElement();\n\n      this.mediaStreamTrack.addEventListener('ended', function onended() {\n        self._end();\n        self.mediaStreamTrack.removeEventListener('ended', onended);\n      });\n\n      if (this._dummyEl) {\n        this._dummyEl.muted = true;\n        this._dummyEl.oncanplay = this._start.bind(this, this._dummyEl);\n        this._attach(this._dummyEl);\n        this._attachments.delete(this._dummyEl);\n      }\n    }\n\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_end',\n    value: function _end() {\n      this._log.debug('Ended');\n      if (this._dummyEl) {\n        this._detachElement(this._dummyEl);\n        this._dummyEl.oncanplay = null;\n      }\n    }\n  }, {\n    key: 'attach',\n    value: function attach(el) {\n      if (typeof el === 'string') {\n        el = this._selectElement(el);\n      } else if (!el) {\n        el = this._createElement();\n      }\n      this._log.debug('Attempting to attach to element:', el);\n      el = this._attach(el);\n\n      return el;\n    }\n\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_attach',\n    value: function _attach(el) {\n      var mediaStream = el.srcObject;\n      if (!(mediaStream instanceof this._MediaStream)) {\n        mediaStream = new this._MediaStream();\n      }\n\n      var getTracks = this.mediaStreamTrack.kind === 'audio' ? 'getAudioTracks' : 'getVideoTracks';\n\n      mediaStream[getTracks]().forEach(function (mediaStreamTrack) {\n        mediaStream.removeTrack(mediaStreamTrack);\n      });\n      mediaStream.addTrack(this.mediaStreamTrack);\n\n      // NOTE(mpatwardhan): resetting `srcObject` here, causes flicker (JSDK-2641), but it lets us\n      // to sidestep the a chrome bug: https://bugs.chromium.org/p/chromium/issues/detail?id=1052353\n      //\n      el.srcObject = mediaStream;\n      el.autoplay = true;\n      el.playsInline = true;\n\n      if (!this._attachments.has(el)) {\n        this._attachments.add(el);\n      }\n\n      return el;\n    }\n\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_selectElement',\n    value: function _selectElement(selector) {\n      var el = document.querySelector(selector);\n\n      if (!el) {\n        throw new Error('Selector matched no element: ' + selector);\n      }\n\n      return el;\n    }\n\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_createElement',\n    value: function _createElement() {\n      return typeof document !== 'undefined' ? document.createElement(this.kind) : null;\n    }\n  }, {\n    key: 'detach',\n    value: function detach(el) {\n      var els = void 0;\n\n      if (typeof el === 'string') {\n        els = [this._selectElement(el)];\n      } else if (!el) {\n        els = this._getAllAttachedElements();\n      } else {\n        els = [el];\n      }\n\n      this._log.debug('Attempting to detach from elements:', els);\n      this._detachElements(els);\n      return el ? els[0] : els;\n    }\n\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_detachElements',\n    value: function _detachElements(elements) {\n      return elements.map(this._detachElement.bind(this));\n    }\n\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_detachElement',\n    value: function _detachElement(el) {\n      if (!this._attachments.has(el)) {\n        return el;\n      }\n\n      var mediaStream = el.srcObject;\n      if (mediaStream instanceof this._MediaStream) {\n        mediaStream.removeTrack(this.mediaStreamTrack);\n      }\n\n      this._attachments.delete(el);\n      return el;\n    }\n\n    /**\n     * @private\n     */\n\n  }, {\n    key: '_getAllAttachedElements',\n    value: function _getAllAttachedElements() {\n      var els = [];\n\n      this._attachments.forEach(function (el) {\n        els.push(el);\n      });\n\n      return els;\n    }\n  }]);\n\n  return MediaTrack;\n}(Track);\n\nmodule.exports = MediaTrack;"]},"metadata":{},"sourceType":"script"}